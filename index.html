<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>í‰ì´Œì´ˆ êµì‚¬ìš© ìˆ˜ì—… ë„êµ¬ </title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="header-nav">
  <h1 class="page-title">í‰ì´Œì´ˆ êµì‚¬ìš© ìˆ˜ì—… ë„êµ¬</h1>
  <nav class="nav-links">
    <a href="https://hi.goe.go.kr" target="_blank" class="nav-btn">í•˜ì´ëŸ¬ë‹</a>
    <a href="https://www.hiclass.net/" target="_blank" class="nav-btn">Hiclass</a>
  </nav>
</header>
<p style="text-align:center;">ì„ ìƒë‹˜ ì˜¤ëŠ˜ í•˜ë£¨ë„ í‰ì•ˆí•˜ì„¸ìš”â¤ï¸</p>

  <!-- ì „ì²´ ì„¹ì…˜ì„ ê°ì‹¸ëŠ” ì»¨í…Œì´ë„ˆ (ë“œë˜ê·¸ì•¤ë“œë¡­ìš©) -->
  <div id="sectionsContainer">
    <!-- 1. ì¹ íŒ -->
    <div class="section" draggable="true">
      <div class="section-header">
        <span>ìˆ˜ì—… ì¹ íŒ</span>
        <button class="toggle-btn" aria-label="toggle">ì ‘ê¸°/í¼ì¹˜ê¸°</button>
      </div>
      <div class="section-content">
        <div class="chalkboard-container">
          <div class="text-tools">
            <button id="boldBtn" title="êµµê²Œ"><strong>B</strong></button>
            <button id="italicBtn" title="ê¸°ìš¸ì„"><em>I</em></button>
            <button id="underlineBtn" title="ë°‘ì¤„"><u>U</u></button>
            <div class="divider"></div>
            
            <!-- ê¸€ì í¬ê¸°: ì‘ê²Œ(16px), ë³´í†µ(18px), í¬ê²Œ(24px), ë§¤ìš° í¬ê²Œ(32px) -->
            <select id="fontSizeSelector" title="ê¸€ì í¬ê¸°">
              <option value="16px">ì‘ê²Œ</option>
              <option value="18px" selected>ë³´í†µ</option>
              <option value="24px">í¬ê²Œ</option>
              <option value="32px">ë§¤ìš° í¬ê²Œ</option>
            </select>
            
            <!-- í…ìŠ¤íŠ¸ ìƒ‰ê¹”ì— ê²€ì •ìƒ‰ ì¶”ê°€ -->
            <select id="textColorSelector" title="ê¸€ì ìƒ‰ìƒ">
              <option value="white">í°ìƒ‰</option>
              <option value="black">ê²€ì •ìƒ‰</option>
              <option value="yellow">ë…¸ë€ìƒ‰</option>
              <option value="lightblue">í•˜ëŠ˜ìƒ‰</option>
              <option value="pink">ë¶„í™ìƒ‰</option>
              <option value="#ffcc00">ì£¼í™©ìƒ‰</option>
              <option value="#90ee90">ì—°ë‘ìƒ‰</option>
            </select>
            
            <button id="highlightBtn" title="ê°•ì¡°í‘œì‹œ">í˜•ê´‘íœ</button>
            <div class="divider"></div>
            
            <!-- ì „ì²´ ì§€ìš°ê¸° -->
            <button id="clearBtn" title="ì§€ìš°ê¸°">ì „ì²´ ì§€ìš°ê¸°</button>
            <button id="copyBtn" title="ë³µì‚¬">ë³µì‚¬</button>
          </div>
          <!-- ğŸ‘‰ ì´ ìœ„ì¹˜ì— ì¶”ê°€ ğŸ‘ˆ -->
  <div class="divider"></div>
  <button id="youtubeEmbedBtn" title="ìœ íŠœë¸Œ ì‚½ì…">ìœ íŠœë¸Œ</button>
</div>
          <div class="chalkboard">
            <div class="editor-container">
              <div id="chalkboardEditor" contenteditable="true" spellcheck="false"
                   placeholder="ì—¬ê¸°ì— ìˆ˜ì—… ë‚´ìš©ì„ ì ìœ¼ì„¸ìš”...">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
<!-- 2. ì˜¤ëŠ˜ ë‚ ì§œ & ì‹œê°„í‘œ -->
<div class="section" draggable="true">
  <div class="section-header">
    <span>ì˜¤ëŠ˜ ë‚ ì§œ ë° ì‹œê°„í‘œ</span>
    <button class="toggle-btn" aria-label="toggle">ì ‘ê¸°/í¼ì¹˜ê¸°</button>
  </div>
  <div class="section-content">
    <div class="date-timetable-section">
      <div class="date-timetable">
        <strong>ì˜¤ëŠ˜ ë‚ ì§œ:</strong> <span id="todayInfo"></span>
      </div>
      <div class="timetable-container">
        <table class="timetable">
          <thead>
            <tr>
              <th>1êµì‹œ</th>
              <th>2êµì‹œ</th>
              <th>3êµì‹œ</th>
              <th>4êµì‹œ</th>
              <th>5êµì‹œ</th>
              <th>6êµì‹œ</th>
            </tr>
          </thead>
          <tbody>
            <tr id="timetableRow"></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
  // 1. ì˜¤ëŠ˜ ë‚ ì§œ ìë™ í‘œê¸°
  document.getElementById('todayInfo').textContent = new Date().toLocaleDateString();

  // 2. ê³¼ëª© ì˜µì…˜ ëª©ë¡
  const subjects = [
    'êµ­ì–´', 'ìˆ˜í•™', 'ì‚¬íšŒ', 'ê³¼í•™', 'ì˜ì–´', 'ìŒì•…', 'ë¯¸ìˆ ',
    'ì²´ìœ¡', 'ì‹¤ê³¼', 'ë„ë•', 'í•™êµ', 'ì‚¬ëŒë“¤', 'ìš°ë¦¬ë‚˜ë¼',
    'íƒí—˜', 'ë‚˜', 'ìì—°', 'ë§ˆì„', 'ì„¸ê³„', 'ì…ë ¥'
  ];

  // 3. ì‹œê°„í‘œ ë™ì  ìƒì„±
  const timetableRow = document.getElementById('timetableRow');

  for (let i = 0; i < 6; i++) {
    const td = document.createElement('td');
    const select = document.createElement('select');
    select.classList.add('subjectSelector');

    // ê¸°ë³¸ ì˜µì…˜ ì¶”ê°€
    const defaultOption = document.createElement('option');
    defaultOption.textContent = 'ì„ íƒ';
    select.appendChild(defaultOption);

    // ê³¼ëª© ì˜µì…˜ ì¶”ê°€
    subjects.forEach(subject => {
      const option = document.createElement('option');
      option.value = subject;
      option.textContent = subject;
      select.appendChild(option);
    });

    // ì§ì ‘ ì…ë ¥ í•„ë“œ
    const input = document.createElement('input');
    input.type = 'text';
    input.classList.add('customSubject');
    input.placeholder = 'ì§ì ‘ ì…ë ¥';
    input.style.display = 'none';

    // ì„ íƒì´ 'ì…ë ¥'ì¼ ê²½ìš°, ì…ë ¥ í•„ë“œ í‘œì‹œ
    select.addEventListener('change', (e) => {
      input.style.display = e.target.value === 'ì…ë ¥' ? 'inline-block' : 'none';
    });

    td.appendChild(select);
    td.appendChild(input);
    timetableRow.appendChild(td);
  }
</script>

    </div>    <!-- Perplexity ê²€ìƒ‰ -->
    <div class="section" draggable="true">
      <div class="section-header">
        <span>Perplexity ê²€ìƒ‰</span>
        <button class="toggle-btn" aria-label="toggle">ì ‘ê¸°/í¼ì¹˜ê¸°</button>
      </div>
      <div class="section-content">
        <div class="picker-section" style="padding: 20px;">
          <div class="picker-controls" style="margin-bottom: 10px; flex-wrap: nowrap;">
            <label for="perplexInput" style="margin-right: 5px;">ê²€ìƒ‰ì–´:</label>
            <input type="text" id="perplexInput" placeholder="ê¶ê¸ˆí•œ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" style="flex:1; min-width:200px;"/>
            <button id="perplexBtn" style="margin-left: 10px;">ê²€ìƒ‰</button>
          </div>
          <p>Perplexity.ai ë¡œ ì´ë™í•˜ì—¬ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        </div>
      </div>
    </div>

    <div class="section" draggable="true">
      <div class="section-header">
        <span>ì‹œê°„ ê´€ë¦¬</span>
        <button class="toggle-btn" aria-label="toggle">ì ‘ê¸°/í¼ì¹˜ê¸°</button>
      </div>
      <div class="section-content">
        <div class="time-section">
          <!-- ë””ì§€í„¸ ì‹œê³„ -->
          <div class="clock">
            <h3>í˜„ì¬ ì‹œê°„</h3>
            <div id="clockDisplay" class="time-display">00:00:00</div>
            <div id="dateDisplay"></div>
          </div>

          <!-- íƒ€ì´ë¨¸ -->
          <div class="timer">
            <h3>ìˆ˜ì—… íƒ€ì´ë¨¸</h3>
            <div class="timer-inputs">
              <input type="number" id="hoursInput" min="0" max="99" placeholder="ì‹œ" style="width: 60px" />
              <input type="number" id="minutesInput" min="0" max="59" placeholder="ë¶„" style="width: 60px" />
              <input type="number" id="secondsInput" min="0" max="59" placeholder="ì´ˆ" style="width: 60px" />
            </div>
            <div id="timerDisplay" class="time-display">00:00:00</div>
            <div class="timer-controls">
              <button id="startTimerBtn" class="start-btn">ì‹œì‘</button>
              <button id="stopTimerBtn" class="stop-btn">ì •ì§€</button>
              <button id="resetTimerBtn" class="reset-btn">ì´ˆê¸°í™”</button>
            </div>
          </div>
        </div>
      </div>
    </div>

  <div id="sectionsContainer">
    <!-- ì•ˆì–‘ í‰ì´Œì´ˆ í•™ì‚¬ì¼ì • & ê¸‰ì‹ -->
    <div class="section" draggable="true">
      <div class="section-header">
        <span>ì•ˆì–‘ í‰ì´Œì´ˆ í•™ì‚¬ì¼ì • & ê¸‰ì‹</span>
        <button class="toggle-btn" aria-label="toggle">ì ‘ê¸°/í¼ì¹˜ê¸°</button>
      </div>
      <div class="section-content" style="padding: 20px;">
        <h3>ë‹¨ìœ„ ì„ íƒ</h3>
        <div class="unit-selection">
          <label for="scheduleUnit">í•™ì‚¬ì¼ì • ë‹¨ìœ„:</label>
          <select id="scheduleUnit">
            <option value="day">ì¼ê°„</option>
            <option value="week">ì£¼ê°„</option>
            <option value="month" selected>ì›”ê°„</option>
          </select>
          
          <label for="mealUnit">ê¸‰ì‹ ì •ë³´ ë‹¨ìœ„:</label>
          <select id="mealUnit">
            <option value="day">ì¼ê°„</option>
            <option value="week">ì£¼ê°„</option>
            <option value="month" selected>ì›”ê°„</option>
          </select>
        </div>

        <h3>í•™ì‚¬ì¼ì •</h3>
        <button id="fetchScheduleBtn">í•™ì‚¬ì¼ì • ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <div id="scheduleResult" class="result-area"></div>

        <hr style="margin:20px 0;" />

        <h3>ê¸‰ì‹ì •ë³´</h3>
        <button id="fetchMealsBtn">ê¸‰ì‹ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <div id="mealsResult" class="result-area"></div>
      </div>
    </div>

  </div> <!-- sectionsContainer end -->

    <!-- 4. í•™ìƒ ë½‘ê¸° -->
    <div class="section" draggable="true">
      <div class="section-header">
        <span>í•™ìƒ ë½‘ê¸°</span>
        <button class="toggle-btn" aria-label="toggle">ì ‘ê¸°/í¼ì¹˜ê¸°</button>
      </div>
      <div class="section-content">
        <div class="picker-section">
          <div class="picker-controls">
            <div>
              <label for="totalStudents">í•™ìƒ ì´ ìˆ˜:</label>
              <input type="number" id="totalStudents" min="1" value="30" />
            </div>
            <div>
              <label for="pickCount">ë½‘ì„ í•™ìƒ ìˆ˜:</label>
              <input type="number" id="pickCount" min="1" value="1" />
            </div>
            <button id="pickStudentsBtn">í•™ìƒ ë½‘ê¸°</button>
            <button id="resetPickerBtn">ì´ˆê¸°í™”</button>
          </div>
          <div id="pickerResult" class="result-area">
            <p>í•™ìƒì„ ë½‘ìœ¼ë©´ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- 5. ëª¨ë‘  í¸ì„± -->
    <div class="section" draggable="true">
      <div class="section-header">
        <span>ëª¨ë‘  í¸ì„±</span>
        <button class="toggle-btn" aria-label="toggle">ì ‘ê¸°/í¼ì¹˜ê¸°</button>
      </div>
      <div class="section-content">
        <div class="picker-section">
          <div class="picker-controls">
            <div>
              <label for="teamTotalStudents">í•™ìƒ ì´ ìˆ˜:</label>
              <input type="number" id="teamTotalStudents" min="1" value="30" />
            </div>
            <div>
              <label for="missingNumbers">ì—†ëŠ” ë²ˆí˜¸:</label>
              <input type="text" id="missingNumbers" placeholder="ì˜ˆ: 3, 7, 15" style="width:120px"/>
            </div>
            <div>
              <label for="groupCount">ëª¨ë‘  ìˆ˜:</label>
              <input type="number" id="groupCount" min="1" value="4" />
            </div>
            <button id="makeTeamsBtn">ëª¨ë‘  ì§œê¸°</button>
            <button id="resetTeamsBtn">ì´ˆê¸°í™”</button>
          </div>
          <div id="teamsResult" class="result-area">
            <p>ëª¨ë‘  í¸ì„± ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
          </div>
        </div>
      </div>
    </div>
  </div> <!-- sectionsContainer end -->

  <script>
    // -----------------------------
    // (A) ì ‘ì—ˆë‹¤ í´ê¸° ê¸°ëŠ¥
    // -----------------------------
    const sections = document.querySelectorAll('.section');
    sections.forEach((sec) => {
      const header = sec.querySelector('.section-header');
      const toggleBtn = sec.querySelector('.toggle-btn');
      const content = sec.querySelector('.section-content');
      if (header && content && toggleBtn) {
        header.addEventListener('click', () => {
          // toggle content
          content.classList.toggle('hidden');
        });
      }
    });

    // -----------------------------
    // (B) ì„¹ì…˜ Drag & Drop ê¸°ëŠ¥
    // -----------------------------
    const container = document.getElementById('sectionsContainer');
    let draggedSection = null;

    // ëª¨ë“  .section ìš”ì†Œì— ëŒ€í•´, dragstart / dragend / dragover / drop í•¸ë“¤ëŸ¬ ì„¤ì •
    sections.forEach((section) => {
      // ë“œë˜ê·¸ ì‹œì‘
      section.addEventListener('dragstart', (e) => {
        draggedSection = section;
        section.style.opacity = '0.4'; // ì‹œê°ì  íš¨ê³¼
      });

      // ë“œë˜ê·¸ ë
      section.addEventListener('dragend', (e) => {
        draggedSection = null;
        section.style.opacity = '1';
      });

      // ë“œë˜ê·¸ ì¤‘, ë‹¤ë¥¸ ì„¹ì…˜ ìœ„ì— ì˜¤ë©´
      section.addEventListener('dragover', (e) => {
        e.preventDefault(); // drop ì´ë²¤íŠ¸ í—ˆìš©
      });

      // ë“œë¡­
      section.addEventListener('drop', (e) => {
        e.preventDefault();
        if (!draggedSection) return;
        if (draggedSection === section) return; // ìê¸° ìì‹  ìœ„ë¼ë©´ ë¬´ì‹œ

        // ë§ˆìš°ìŠ¤ ìœ„ì¹˜ì™€ ì„¹ì…˜ì˜ ì¤‘ê°„ ì§€ì ì„ ë¹„êµí•´, draggedSectionì„ section ìœ„ë¡œ/ì•„ë˜ë¡œ ë†“ì„ì§€ ê²°ì •
        const rect = section.getBoundingClientRect();
        const midY = rect.top + rect.height / 2;
        const dropY = e.clientY;

        if (dropY < midY) {
          // ì„¹ì…˜ ì¤‘ì•™ë³´ë‹¤ ìœ„ìª½ => draggedSectionì„ section ì•ì—
          container.insertBefore(draggedSection, section);
        } else {
          // ì•„ë˜ìª½ => section ë‹¤ìŒì—
          container.insertBefore(draggedSection, section.nextSibling);
        }
      });
    });

    // -----------------------------
    // 1. ì¹ íŒ ê¸°ëŠ¥
    // -----------------------------
    const chalkboardEditor = document.getElementById('chalkboardEditor');
    const boldBtn = document.getElementById('boldBtn');
    const italicBtn = document.getElementById('italicBtn');
    const underlineBtn = document.getElementById('underlineBtn');
    const fontSizeSelector = document.getElementById('fontSizeSelector');
    const textColorSelector = document.getElementById('textColorSelector');
    const highlightBtn = document.getElementById('highlightBtn');
    const clearBtn = document.getElementById('clearBtn');
    const copyBtn = document.getElementById('copyBtn');

    boldBtn.addEventListener('click', () => {
      document.execCommand('bold', false, null);
      chalkboardEditor.focus();
    });
    italicBtn.addEventListener('click', () => {
      document.execCommand('italic', false, null);
      chalkboardEditor.focus();
    });
    underlineBtn.addEventListener('click', () => {
      document.execCommand('underline', false, null);
      chalkboardEditor.focus();
    });

    // í°íŠ¸ í¬ê¸° (ì‘ê²Œ~ë§¤ìš° í¬ê²Œ)
    // execCommand('fontSize', false, ...)ëŠ” ì •ìˆ˜ê°’(1~7)ë§Œ ë°›ìœ¼ë¯€ë¡œ, px -> ìˆ«ì ë§¤í•‘
    const sizeMap = {
      '16px': '2', // ì‘ê²Œ
      '18px': '3', // ë³´í†µ
      '24px': '5', // í¬ê²Œ
      '32px': '7', // ë§¤ìš° í¬ê²Œ
    };

    fontSizeSelector.addEventListener('change', () => {
      const chosenPx = fontSizeSelector.value;
      const commandValue = sizeMap[chosenPx] || '3';
      // 1) execCommandë¡œ ì„ì‹œ font size ì„¤ì •
      document.execCommand('fontSize', false, commandValue);

      // 2) ë°©ê¸ˆ ì ìš©ëœ <font size="commandValue"> ìš”ì†Œë“¤ì„ ì°¾ì•„ style.fontSizeë¡œ ì¹˜í™˜
      const selection = window.getSelection();
      if (selection.rangeCount > 0) {
        const range = selection.getRangeAt(0);
        if (!range.collapsed) {
          const clonedContents = range.cloneContents();
          const elements = clonedContents.querySelectorAll('font[size="' + commandValue + '"]');
          for (let i = 0; i < elements.length; i++) {
            elements[i].removeAttribute('size');
            elements[i].style.fontSize = chosenPx;
          }
          range.deleteContents();
          range.insertNode(clonedContents);
        }
      }
      chalkboardEditor.focus();
    });

    // ê¸€ì ìƒ‰
    textColorSelector.addEventListener('change', () => {
      document.execCommand('foreColor', false, textColorSelector.value);
      chalkboardEditor.focus();
    });

    // í˜•ê´‘íœ (ë°°ê²½ìƒ‰)
    highlightBtn.addEventListener('click', () => {
      document.execCommand('hiliteColor', false, 'yellow');
      chalkboardEditor.focus();
    });

    // ì „ì²´ ì§€ìš°ê¸°
    clearBtn.addEventListener('click', () => {
      chalkboardEditor.innerHTML = '';
    });

    // ë³µì‚¬ ë²„íŠ¼
    copyBtn.addEventListener('click', () => {
      /* TODO: Confirm with user: if environment blocks navigator.clipboard, fallback is used. Is that expected? */
      const text = chalkboardEditor.innerText || chalkboardEditor.textContent;
      // Attempt newer API first
      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(text)
          .then(() => alert('ì¹ íŒ ë‚´ìš©ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'))
          .catch(err => {
            console.error('Clipboard API error:', err);
            fallbackCopy(text);
          });
      } else {
        fallbackCopy(text);
      }
    });

    // Older fallback method
    function fallbackCopy(str) {
      try {
        const temp = document.createElement('textarea');
        temp.value = str;
        document.body.appendChild(temp);
        temp.select();
        document.execCommand('copy');
        document.body.removeChild(temp);
        alert('ì¹ íŒ ë‚´ìš©ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! (fallback)');
      } catch (err) {
        console.error('Fallback copy error:', err);
        alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }
    function embedYoutubeIntoChalkboard(youtubeUrl, width, height) {
  let videoId = '';
  const regexShort = /youtu\.be\/(.+)/;
  const regexLong  = /v=([^&]+)/;

  if (regexShort.test(youtubeUrl)) {
    videoId = youtubeUrl.match(regexShort)[1].split('?')[0];
  } else if (regexLong.test(youtubeUrl)) {
    videoId = youtubeUrl.match(regexLong)[1];
  } else {
    alert('ìœ íš¨í•œ ìœ íŠœë¸Œ ì£¼ì†Œê°€ ì•„ë‹™ë‹ˆë‹¤.');
    return;
  }

  const embedUrl = `https://www.youtube.com/embed/${videoId}`;
  const iframeHtml = `
    <div class="youtube-embed" style="width:${width}; height:${height};">
      <iframe src="${embedUrl}" frameborder="0" allowfullscreen></iframe>
    </div>
  `;

  chalkboardEditor.innerHTML += iframeHtml;
}

// ë²„íŠ¼ ì´ë²¤íŠ¸
const youtubeEmbedBtn = document.getElementById('youtubeEmbedBtn');
youtubeEmbedBtn.addEventListener('click', () => {
  const url = prompt('ìœ íŠœë¸Œ ë§í¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”.\nì˜ˆ) https://youtu.be/xxxxx');
  if (!url) return;

  // ì‚¬ìš©ìì—ê²Œ í¬ê¸° ì…ë ¥ë°›ê¸°
  let width = prompt('ë™ì˜ìƒì˜ ë„ˆë¹„ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 600px ë˜ëŠ” 100%)', '100%');
  if (!width) width = '100%';
  
  let height = prompt('ë™ì˜ìƒì˜ ë†’ì´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 300px ë˜ëŠ” auto)', 'auto');
  if (!height) height = 'auto';

  embedYoutubeIntoChalkboard(url.trim(), width, height);
});

    // -----------------------------
    // 2. ì˜¤ëŠ˜ ë‚ ì§œ ë° ì‹œê°„í‘œ
    // -----------------------------
    const todayInfo = document.getElementById('todayInfo');
    function formatKoreanDate(date) {
      const year = date.getFullYear();
      const month = date.getMonth() + 1;
      const day = date.getDate();
      const weekdays = ['ì¼ìš”ì¼', 'ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼'];
      const weekday = weekdays[date.getDay()];
      return `${year}ë…„ ${month}ì›” ${day}ì¼ ${weekday}`;
    }
    todayInfo.textContent = formatKoreanDate(new Date());

    const subjectColors = {
      'êµ­ì–´': '#ffe0e0',
      'ìˆ˜í•™': '#e0ffe0',
      'ì‚¬íšŒ': '#e0e0ff',
      'ê³¼í•™': '#ffe0ff',
      'ì˜ì–´': '#fffee0',
      'ìŒì•…': '#e0ffff',
      'ë¯¸ìˆ ': '#ffffe0',
      'ì²´ìœ¡': '#d6f5d6',
      'ì‹¤ê³¼': '#ffd5ec',
      'ë„ë•': '#e3ffd5',
      'ìœ¤ë¦¬': '#f3d5ff',
      'ì—­ì‚¬': '#fff0c5',
      'ê°€ì •': '#fce0ff',
      'ê¸°ìˆ ': '#d5fff0'
    };
    const subjectSelectors = document.querySelectorAll('.subjectSelector');
    subjectSelectors.forEach((sel) => {
      sel.addEventListener('change', function () {
        const parentCell = sel.closest('td');
        const customInput = parentCell.querySelector('.customSubject');
        const selectedValue = this.value;
        if (selectedValue === 'ì…ë ¥') {
          customInput.style.display = 'block';
          parentCell.style.backgroundColor = '';
        } else {
          customInput.style.display = 'none';
          parentCell.style.backgroundColor = subjectColors[selectedValue] || '#ffffcc';
        }
      });
    });

    // -----------------------------
    // 3. ë””ì§€í„¸ ì‹œê³„ & íƒ€ì´ë¨¸ ê¸°ëŠ¥ + ì‚¬ìš´ë“œ
    // -----------------------------
    const clockDisplay = document.getElementById('clockDisplay');
    const dateDisplay = document.getElementById('dateDisplay');

    function updateClock() {
      const now = new Date();
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      const seconds = String(now.getSeconds()).padStart(2, '0');

      clockDisplay.textContent = `${hours}:${minutes}:${seconds}`;

      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      dateDisplay.textContent = now.toLocaleDateString('ko-KR', options);
    }
    setInterval(updateClock, 1000);
    updateClock();

    const hoursInput = document.getElementById('hoursInput');
    const minutesInput = document.getElementById('minutesInput');
    const secondsInput = document.getElementById('secondsInput');
    const timerDisplay = document.getElementById('timerDisplay');
    const startTimerBtn = document.getElementById('startTimerBtn');
    const stopTimerBtn = document.getElementById('stopTimerBtn');
    const resetTimerBtn = document.getElementById('resetTimerBtn');

    function playBeep() {
      const AudioContext = window.AudioContext || window.webkitAudioContext;
      if (!window.beepContext) {
        window.beepContext = new AudioContext();
      }
      const ctx = window.beepContext;
      const oscillator = ctx.createOscillator();
      oscillator.type = 'sine';
      oscillator.frequency.setValueAtTime(440, ctx.currentTime);
      const gainNode = ctx.createGain();
      gainNode.gain.value = 0.2;
      oscillator.connect(gainNode);
      gainNode.connect(ctx.destination);
      oscillator.start();
      setTimeout(() => {
        oscillator.stop();
      }, 500);
    }

    let timerInterval;
    let timerSeconds = 0;

    function updateTimerDisplay() {
      const hours = Math.floor(timerSeconds / 3600);
      const minutes = Math.floor((timerSeconds % 3600) / 60);
      const seconds = timerSeconds % 60;
      timerDisplay.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    startTimerBtn.addEventListener('click', () => {
      if (!timerInterval) {
        if (timerSeconds === 0) {
          const h = parseInt(hoursInput.value) || 0;
          const m = parseInt(minutesInput.value) || 0;
          const s = parseInt(secondsInput.value) || 0;
          timerSeconds = h * 3600 + m * 60 + s;
          if (timerSeconds === 0) return;
        }
        timerInterval = setInterval(() => {
          if (timerSeconds > 0) {
            timerSeconds--;
            updateTimerDisplay();
          } else {
            clearInterval(timerInterval);
            timerInterval = null;
            playBeep();
            alert('íƒ€ì´ë¨¸ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
          }
        }, 1000);
      }
    });

    stopTimerBtn.addEventListener('click', () => {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    });

    resetTimerBtn.addEventListener('click', () => {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      hoursInput.value = '';
      minutesInput.value = '';
      secondsInput.value = '';
      timerSeconds = 0;
      updateTimerDisplay();
    });

    // Perplexity ê²€ìƒ‰ ë¡œì§
    const perplexBtn = document.getElementById('perplexBtn');
    const perplexInput = document.getElementById('perplexInput');
    if (perplexBtn && perplexInput) {
      perplexBtn.addEventListener('click', () => {
        const query = encodeURIComponent(perplexInput.value.trim());
        if (!query) {
          alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”!');
          return;
        }
        const perplexUrl = `https://www.perplexity.ai/?q=${query}`;
        window.open(perplexUrl, '_blank');
      });
    }

    // -----------------------------
    // (1) í•™ì‚¬ì¼ì • ë¶ˆëŸ¬ì˜¤ê¸° (ë‹¨ìœ„ì— ë§ì¶°ì„œ)
    // -----------------------------
    const fetchScheduleBtn = document.getElementById('fetchScheduleBtn');
    const scheduleResult = document.getElementById('scheduleResult');

    fetchScheduleBtn.addEventListener('click', async () => {
      const scheduleUnit = document.getElementById('scheduleUnit').value; // ì‚¬ìš©ìê°€ ì„ íƒí•œ ë‹¨ìœ„
      let startDate, endDate;

      // ë‹¨ìœ„ì— ë”°ë¼ ë‚ ì§œ ë²”ìœ„ ì„¤ì •
      const today = new Date();
      const year = today.getFullYear();
      const month = String(today.getMonth() + 1).padStart(2, '0');
      const day = String(today.getDate()).padStart(2, '0');
      
      if (scheduleUnit === 'day') {
        startDate = `${year}${month}${day}`;
        endDate = startDate;
      } else if (scheduleUnit === 'week') {
        const weekStart = new Date(today.setDate(today.getDate() - today.getDay())); // ì£¼ ì‹œì‘ ë‚ ì§œ
        const weekEnd = new Date(weekStart);
        weekEnd.setDate(weekStart.getDate() + 6); // ì£¼ ì¢…ë£Œ ë‚ ì§œ
        startDate = `${weekStart.getFullYear()}${String(weekStart.getMonth() + 1).padStart(2, '0')}${String(weekStart.getDate()).padStart(2, '0')}`;
        endDate = `${weekEnd.getFullYear()}${String(weekEnd.getMonth() + 1).padStart(2, '0')}${String(weekEnd.getDate()).padStart(2, '0')}`;
      } else {
        startDate = `${year}${month}01`;
        endDate = `${year}${month}31`; // í•´ë‹¹ ì›” ì „ì²´ ë‚ ì§œ
      }

      const scheduleUrl = `https://open.neis.go.kr/hub/SchoolSchedule?Type=json`
        + `&KEY=cadc2f03764c4bba97ce5d8ddf6d10cb`
        + `&ATPT_OFCDC_SC_CODE=J10`
        + `&SD_SCHUL_CODE=7569047`
        + `&AA_FROM_YMD=${startDate}`
        + `&AA_TO_YMD=${endDate}`;

      const res = await fetch(scheduleUrl);
      if (!res.ok) throw new Error('í•™ì‚¬ì¼ì • API ì˜¤ë¥˜');

      const data = await res.json();
      if (!data.SchoolSchedule) {
        scheduleResult.innerHTML = 'í•™ì‚¬ì¼ì • ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.';
        return;
      }

      const rows = data.SchoolSchedule[1].row;
      let html = '<ul>';
      rows.forEach(item => {
        html += `<li><strong>${item.AA_YMD}</strong> : ${item.EVENT_NM}</li>`;
      });
      html += '</ul>';
      scheduleResult.innerHTML = html;
    });

    // -----------------------------
// (2) ê¸‰ì‹ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° (ë‹¨ìœ„ì— ë”°ë¼)
// -----------------------------
const fetchMealsBtn = document.getElementById('fetchMealsBtn');
const mealsResult = document.getElementById('mealsResult');

// ë‚ ì§œë¥¼ 'YYYYMMDD' í˜•ì‹ìœ¼ë¡œ í¬ë§·í•˜ëŠ” í•¨ìˆ˜
const formatDate = (date) =>
  `${date.getFullYear()}${String(date.getMonth() + 1).padStart(2, '0')}${String(date.getDate()).padStart(2, '0')}`;

fetchMealsBtn.addEventListener('click', async () => {
  const mealUnit = document.getElementById('mealUnit').value; // ì‚¬ìš©ìê°€ ì„ íƒí•œ ë‹¨ìœ„
  const today = new Date();

  let startDate, endDate;

  try {
    // ì„ íƒí•œ ë‹¨ìœ„ì— ë”°ë¼ ë‚ ì§œ ë²”ìœ„ ì„¤ì •
    switch (mealUnit) {
      case 'day':
        startDate = endDate = formatDate(today);
        break;
      case 'week':
        const weekStart = new Date(today.setDate(today.getDate() - today.getDay()));
        const weekEnd = new Date(weekStart);
        weekEnd.setDate(weekStart.getDate() + 6);
        startDate = formatDate(weekStart);
        endDate = formatDate(weekEnd);
        break;
      default:
        startDate = `${today.getFullYear()}${String(today.getMonth() + 1).padStart(2, '0')}01`;
        endDate = `${today.getFullYear()}${String(today.getMonth() + 1).padStart(2, '0')}31`;
    }

    const mealsUrl = `https://open.neis.go.kr/hub/mealServiceDietInfo?Type=json&KEY=cadc2f03764c4bba97ce5d8ddf6d10cb&ATPT_OFCDC_SC_CODE=J10&SD_SCHUL_CODE=7569022&MLSV_FROM_YMD=${startDate}&MLSV_TO_YMD=${endDate}`;
    
    const res = await fetch(mealsUrl);
    if (!res.ok) throw new Error('ê¸‰ì‹ API ì˜¤ë¥˜');

    const data = await res.json();
    if (!data.mealServiceDietInfo) {
      mealsResult.innerHTML = 'ê¸‰ì‹ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.';
      return;
    }

    // ê¸‰ì‹ ì •ë³´ ì¶œë ¥
    const rows = data.mealServiceDietInfo[1].row;
    const html = rows.map(meal => {
      const dateStr = meal.MLSV_YMD;
      const menus = meal.DDISH_NM.replace(/<br\/>/g, ', ');
      return `<li><strong>${dateStr}</strong> : ${menus}</li>`;
    }).join('');
    mealsResult.innerHTML = `<ul>${html}</ul>`;
  } catch (error) {
    mealsResult.innerHTML = `ê¸‰ì‹ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`;
  }
});

// -----------------------------
// 4. ëœë¤ í•™ìƒ ë½‘ê¸°
// -----------------------------
const totalStudentsInput = document.getElementById('totalStudents');
const pickCountInput = document.getElementById('pickCount');
const pickStudentsBtn = document.getElementById('pickStudentsBtn');
const resetPickerBtn = document.getElementById('resetPickerBtn');
const pickerResult = document.getElementById('pickerResult');

let pickedStudents = []; // ì´ë¯¸ ë½‘íŒ í•™ìƒ ì €ì¥

pickStudentsBtn.addEventListener('click', () => {
  const totalStudents = parseInt(totalStudentsInput.value);
  let pickCount = parseInt(pickCountInput.value);

  // ì…ë ¥ê°’ ê²€ì¦
  if (!totalStudents || totalStudents < 1 || !pickCount || pickCount < 1) {
    alert('ìœ íš¨í•œ í•™ìƒ ìˆ˜ì™€ ë½‘ì„ ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
    return;
  }

  // ì´ë¯¸ ë½‘íŒ í•™ìƒ ì œì™¸í•˜ê³  ë‚¨ì€ í•™ìƒ ëª©ë¡ ìƒì„±
  const availableStudents = Array.from({ length: totalStudents }, (_, i) => i + 1)
    .filter(num => !pickedStudents.includes(num));

  if (availableStudents.length === 0) {
    alert('ëª¨ë“  í•™ìƒì´ ì´ë¯¸ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤. ì´ˆê¸°í™” ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.');
    return;
  }

  pickCount = Math.min(pickCount, availableStudents.length);

  // ëœë¤í•˜ê²Œ í•™ìƒ ì„ íƒ
  const selectedStudents = availableStudents.sort(() => Math.random() - 0.5).slice(0, pickCount);
  pickedStudents.push(...selectedStudents);

  // ê²°ê³¼ ì¶œë ¥
  pickerResult.innerHTML = `
    <p><strong>ì„ íƒëœ í•™ìƒ:</strong> ${selectedStudents.sort((a, b) => a - b).join(', ')}</p>
    <p><strong>ì§€ê¸ˆê¹Œì§€ ì„ íƒëœ í•™ìƒ:</strong> ${pickedStudents.sort((a, b) => a - b).join(', ')}</p>
    <p><strong>ë‚¨ì€ í•™ìƒ ìˆ˜:</strong> ${totalStudents - pickedStudents.length}</p>`;
});

resetPickerBtn.addEventListener('click', () => {
  pickedStudents = [];
  pickerResult.innerHTML = '<p>í•™ìƒì„ ë½‘ìœ¼ë©´ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>';
});

// -----------------------------
// 5. ëª¨ë‘  í¸ì„±
// -----------------------------
const makeTeamsBtn = document.getElementById('makeTeamsBtn');
const resetTeamsBtn = document.getElementById('resetTeamsBtn');
const teamTotalStudents = document.getElementById('teamTotalStudents');
const missingNumbersInput = document.getElementById('missingNumbers');
const groupCountInput = document.getElementById('groupCount');
const teamsResult = document.getElementById('teamsResult');

makeTeamsBtn.addEventListener('click', () => {
  const total = parseInt(teamTotalStudents.value);
  const groupCount = parseInt(groupCountInput.value);
  const missingNums = missingNumbersInput.value
    .split(',')
    .map(num => parseInt(num.trim()))
    .filter(num => num && num > 0 && num <= total);

  if (!total || !groupCount || total < 1 || groupCount < 1) {
    alert('ì´ í•™ìƒ ìˆ˜ì™€ ëª¨ë‘  ìˆ˜ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•˜ì„¸ìš”.');
    return;
  }

  // ì œì™¸í•  í•™ìƒì„ ë¹¼ê³  ê°€ëŠ¥í•œ í•™ìƒ ëª©ë¡ ìƒì„±
  const available = Array.from({ length: total }, (_, i) => i + 1).filter(num => !missingNums.includes(num));

  if (available.length === 0) {
    alert('ì‚¬ìš© ê°€ëŠ¥í•œ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤!');
    return;
  }

  // ëœë¤ ì…”í”Œ
  available.sort(() => Math.random() - 0.5);

  const teams = Array.from({ length: groupCount }, () => []);
  available.forEach((student, idx) => {
    teams[idx % groupCount].push(student);
  });

  // ê²°ê³¼ ì¶œë ¥
  const html = teams.map((team, idx) => 
    `<p><strong>${idx + 1}ëª¨ë‘  (${team.length}ëª…):</strong> ${team.sort((a, b) => a - b).join(', ')}</p>`
  ).join('');
  teamsResult.innerHTML = html;
});

resetTeamsBtn.addEventListener('click', () => {
  teamTotalStudents.value = 30;
  missingNumbersInput.value = '';
  groupCountInput.value = 4;
  teamsResult.innerHTML = '<p>ëª¨ë‘  í¸ì„± ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>';
});
</script>

<footer style="text-align: center; padding: 20px 0; background-color: #f8f8f8; border-top: 1px solid #ddd; margin-top: 40px;">
  <p style="font-size: 1rem; color: #2a623d;">
    <a href="https://pebble-stallion-abb.notion.site/1b210244f99780a19431c44075aa2c69?pvs=4" target="_blank" style="color: #2a623d; text-decoration: none;">ê°œë°œìì— ì œì•ˆí•˜ê¸°</a>
  </p>
  <p style="font-size: 1rem; color: #2a623d;">
    &copy; 2025 <a href="https://pc-e.goeay.kr/pc-e/main.do" target="_blank" style="color: #2a623d; text-decoration: none;">í‰ì´Œì´ˆë“±í•™êµ êµì¥ í™©ê²½íƒœ</a>. All Rights Reserved.
  </p>
</footer>


